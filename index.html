<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Drag Race Sorter</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
    }
    h1 {
      margin: 1rem 0;
      font-size: 2rem;
    }
    #controls {
      margin-bottom: 0.5rem;
    }
    #controls button {
      margin: 0 .5rem;
      padding: .5rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      background: #ff69b4;
      color: #fff;
      cursor: pointer;
      transition: background .2s;
    }
    #controls button:hover {
      background: #e5589c;
    }
    #progress {
      color: #ccc;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    #chooser {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
    }
    .option {
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 8px;
      overflow: hidden;
      width: 45%;
      max-width: 400px;
      transition: border-color .2s;
    }
    .option:hover {
      border-color: #ff69b4;
    }
    .option img {
      width: 95vw;
      max-width: 400px;
      height: auto;
      display: block;
      margin: 0 auto;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transition: transform .2s;
    }
    .option img:hover {
      transform: scale(1.02);
    }
    .option .name {
      padding: .5rem;
      background: #222;
      font-size: 1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #results {
      display: none;
      margin: 1rem auto;
      max-width: 600px;
      text-align: left;
      padding: 0 1rem;
    }
    .result-item {
      padding: .3rem 0;
      border-bottom: 1px solid #333;
    }
  </style>
</head>
<body>
  <h1>¿A quién prefieres?</h1>
  <div id="controls">
    <button id="resetBtn">Reiniciar sorter</button>
    <button id="exportBtn" style="display:none">Exportar ranking</button>
  </div>
  <div id="progress">Calculando. 0% de las elecciones hechas</div>
  <div id="chooser"></div>
  <div id="results"></div>

  <script>
    // Lista final de 99 queens con IDs y nombres correctos
    const queenList = [
      {id:"tammie",   name:"Tammie Brown"},
      {id:"raven",    name:"Raven"},
      {id:"jujubee",  name:"Jujubee"},
      {id:"kylie",    name:"Kylie Sonique Love"},
      {id:"raja",     name:"Raja"},
      {id:"manila",   name:"Manila Luzon"},
      {id:"alexis",   name:"Alexis Mateo"},
      {id:"delta",    name:"Delta Work"},
      {id:"chad",     name:"Chad Michaels"},
      {id:"latrice",  name:"Latrice Royale"},
      {id:"willam",   name:"Willam"},
      {id:"jinkx",    name:"Jinkx Monsoon"},
      {id:"alaska",   name:"Alaska"},
      {id:"roxxxy",   name:"Roxxxy Andrews"},
      {id:"detox",    name:"Detox"},
      {id:"montrese", name:"Coco Montrese"},
      {id:"alyssa",   name:"Alyssa Edwards"},
      {id:"bianca",   name:"Bianca del Rio"},
      {id:"adore",    name:"Adore Delano"},
      {id:"courtney", name:"Courtney Act"},
      {id:"ben",      name:"BenDeLaCreme"},
      {id:"violet",   name:"Violet Chachki"},
      {id:"ginger",   name:"Ginger Minj"},
      {id:"pearl",    name:"Pearl"},
      {id:"kennedy",  name:"Kennedy Davenport"},
      {id:"katya",    name:"Katya"},
      {id:"bob",      name:"Bob the Drag Queen"},
      {id:"naomi",    name:"Naomi Smalls"},
      {id:"derrick",  name:"Derrick Barry"},
      {id:"velour",   name:"Sasha Velour"},
      {id:"peppermint",name:"Peppermint"},
      {id:"shea",     name:"Shea Couleé"},
      {id:"trinity",  name:"Trinity the Tuck"},
      {id:"valentina",name:"Valentina"},
      {id:"aja",      name:"Aja"},
      {id:"aquaria",  name:"Aquaria"},
      {id:"eureka",   name:"Eureka"},
      {id:"monet",    name:"Monét X Change"},
      {id:"yvie",     name:"Yvie Oddly"},
      {id:"brooke",   name:"Brooke Lynn Hytes"},
      {id:"vanjie",   name:"Vanessa Vanjie Mateo"},
      {id:"plastique",name:"Plastique Tiara"},
      {id:"jaida",    name:"Jaida Essence Hall"},
      {id:"crystal",  name:"Crystal Methyd"},
      {id:"gigi",     name:"Gigi Goode"},
      {id:"symone",   name:"Symone"},
      {id:"gottmik",  name:"Gottmik"},
      {id:"kandy",    name:"Kandy Muse"},
      {id:"willow",   name:"Willow Pill"},
      {id:"angeria",  name:"Angeria Paris VanMichaels"},
      {id:"bosco",    name:"Bosco"},
      {id:"daya",     name:"Daya Betty"},
      {id:"jorgeous", name:"Jorgeous"},
      {id:"colby",    name:"Sasha Colby"},
      {id:"anetra",   name:"Anetra"},
      {id:"mistress", name:"Mistress Isabelle Brooks"},
      {id:"luxx",     name:"Luxx Noir London"},
      {id:"loosey",   name:"Loosey LaDuca"},
      {id:"nymphia",  name:"Nymphia Wind"},
      {id:"sapphira", name:"Sapphira Cristál"},
      {id:"plane",    name:"Plane Jane"},
      {id:"morphine", name:"Morphine Love Dion"},
      {id:"dawn",     name:"Dawn"},
      {id:"jewels",   name:"Jewels Sparkles"},
      {id:"kori",     name:"Kori King"},
      {id:"lexi",     name:"Lexi Love"},
      {id:"lydia",    name:"Lydia B Collins"},
      {id:"onya",     name:"Onya Nurve"},
      {id:"suzie",    name:"Suzie Toot"},
      {id:"farala",   name:"Carmen Farala"},
      {id:"sagittaria",name:"Sagittaria"},
      {id:"pupi",     name:"Pupi Poisson"},
      {id:"sharonne", name:"Sharonne"},
      {id:"marina",   name:"Marina"},
      {id:"juriji",   name:"Juriji Der Klee"},
      {id:"samantha", name:"Samantha Ballentines"},
      {id:"pakita",   name:"Pakita"},
      {id:"kelly",    name:"Kelly Roller"},
      {id:"angelita", name:"Angelita la Perversa"},
      {id:"chloe",    name:"Chloe Vittu"},
      {id:"ninia",    name:"La Niña Delantro"},
      {id:"coco",     name:"Le Cocó"},
      {id:"vivienne", name:"The Vivienne"},
      {id:"lawrence", name:"Lawrence Chaney"},
      {id:"bimini",   name:"Bimini"},
      {id:"tayce",    name:"Tayce"},
      {id:"awhora",   name:"A’Whora"},
      {id:"tia",      name:"Tia Kofi"},
      {id:"summers",  name:"Marina Summers"},
      {id:"grande",   name:"La Grande Dame"},
      {id:"hannah",   name:"Hannah Conda"},
      {id:"dakota",   name:"Dakota Schiffer"},
      {id:"kyran",    name:"Kyran Thrax"},
      {id:"voix",     name:"La Voix"},
      {id:"priyanka", name:"Priyanka"},
      {id:"jimbo",    name:"Jimbo"},
      {id:"lemon",    name:"Lemon"},
      {id:"icesis",   name:"Icesis Couture"},
      {id:"bebe",     name:"Bebe Zahara Benet"}
    ];

    let sortedLists, leftArr, rightArr, merged;
    let comparisonsDone = 0;
    const totalComparisons = Math.round(queenList.length * Math.log2(queenList.length));

    const chooserDiv  = document.getElementById('chooser');
    const resultsDiv  = document.getElementById('results');
    const progressDiv = document.getElementById('progress');
    const exportBtn   = document.getElementById('exportBtn');
    const resetBtn    = document.getElementById('resetBtn');

    function updateProgress() {
      const pct = Math.min(100,
        Math.round((comparisonsDone / totalComparisons) * 100)
      );
      progressDiv.textContent = `Calculando. ${pct}% de las elecciones hechas`;
    }

    function saveState() {
      localStorage.setItem('dragSorterState',
        JSON.stringify({ sortedLists, leftArr, rightArr, merged, comparisonsDone })
      );
    }
    function clearState() {
      localStorage.removeItem('dragSorterState');
    }

    function startSort() {
      const saved = localStorage.getItem('dragSorterState');
      if (saved) {
        const s = JSON.parse(saved);
        sortedLists     = s.sortedLists;
        leftArr         = s.leftArr;
        rightArr        = s.rightArr;
        merged          = s.merged;
        comparisonsDone = s.comparisonsDone;
        updateProgress();
        if (sortedLists.length === 1 &&
            leftArr.length === 0 &&
            rightArr.length === 0) {
          showFinal(sortedLists[0]);
        } else if (leftArr && rightArr) {
          compareNext();
        } else {
          nextMerge();
        }
      } else {
        // barajar IDs y crear listas individuales
        const ids = queenList.map(q => q.id).sort(() => Math.random() - .5);
        sortedLists     = ids.map(id => [id]);
        comparisonsDone = 0;
        updateProgress();
        nextMerge();
      }
    }

    function nextMerge() {
      if (sortedLists.length === 1) {
        showFinal(sortedLists[0]);
        return;
      }
      leftArr  = sortedLists.shift();
      rightArr = sortedLists.shift();
      merged   = [];
      compareNext();
    }

    function compareNext() {
      if (leftArr.length === 0 && rightArr.length === 0) {
        sortedLists.push(merged);
        saveState();
        nextMerge();
        return;
      }
      if (leftArr.length === 0) {
        merged.push(...rightArr);
        rightArr = [];
        saveState();
        compareNext();
        return;
      }
      if (rightArr.length === 0) {
        merged.push(...leftArr);
        leftArr = [];
        saveState();
        compareNext();
        return;
      }
      comparisonsDone++;
      updateProgress();
      showOptions(leftArr[0], rightArr[0]);
    }

    function showOptions(a, b) {
      chooserDiv.innerHTML = '';
      [a, b].forEach(id => {
        const q = queenList.find(x => x.id === id);
        const div = document.createElement('div');
        div.className = 'option';
        div.innerHTML = `
          <img src="./imgs/${q.id}.png" alt="${q.name}">
          <div class="name">${q.name}</div>
        `;
        div.onclick = () => {
          if (id === a) leftArr.shift(), merged.push(a);
          else           rightArr.shift(), merged.push(b);
          saveState();
          compareNext();
        };
        chooserDiv.appendChild(div);
      });
    }

    function showFinal(finalIds) {
      clearState();
      chooserDiv.style.display = 'none';
      progressDiv.style.display = 'none';
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = '<h2>🏁 Tu ranking final</h2>';
      finalIds.forEach((id, i) => {
        const q = queenList.find(x => x.id === id);
        const div = document.createElement('div');
        div.className = 'result-item';
        div.textContent = `${i+1}. ${q.name}`;
        resultsDiv.appendChild(div);
      });
      exportBtn.style.display = 'inline-block';
      exportBtn.onclick = exportRanking;
    }

    function exportRanking() {
      const lines = Array.from(
        document.querySelectorAll('#results .result-item')
      ).map(el => el.textContent).join('\n');
      const blob = new Blob([lines], { type: 'text/plain' });
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement('a');
      a.href     = url;
      a.download = 'ranking.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    resetBtn.onclick = () => {
      clearState();
      location.reload();
    };

    window.onload = startSort;
  </script>
</body>
</html>
